{% extends 'base.html' %}

{% block title %}Админ-панель | Система заказов{% endblock %}

{% block header %}Админ-панель{% endblock %}

{% block content %}
<div class="admin-panel">
    <div class="admin-section">
        <h3>Продукты</h3>
        <div class="admin-form">
            <textarea id="productsData">{{ products|tojson }}</textarea>
            <button id="saveProducts">Сохранить</button>
        </div>
    </div>
    
    <div class="admin-section">
        <h3>Хоз. товары</h3>
        <div class="admin-form">
            <textarea id="hozData">{{ hoz_items|tojson }}</textarea>
            <button id="saveHoz">Сохранить</button>
        </div>
    </div>
    
    <div class="admin-section">
        <h3>Рыба</h3>
        <div class="admin-form">
            <textarea id="fishData">{{ fish_items|tojson }}</textarea>
            <button id="saveFish">Сохранить</button>
        </div>
    </div>
    
    <div class="admin-section">
        <h3>Курица</h3>
        <div class="admin-form">
            <textarea id="chickenData">{{ chicken_items|tojson }}</textarea>
            <button id="saveChicken">Сохранить</button>
        </div>
    </div>
    
    <div class="admin-section">
        <h3>Пароли</h3>
        <div class="admin-form">
            <div class="form-group">
                <label for="userPassword">Пароль пользователя:</label>
                <input type="text" id="userPassword" value="4444">
            </div>
            <div class="form-group">
                <label for="adminPassword">Пароль администратора:</label>
                <input type="text" id="adminPassword" value="880088">
            </div>
            <button id="savePasswords">Сохранить</button>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
// Сохранение продуктов
document.getElementById('saveProducts').addEventListener('click', function() {
    try {
        var productsData = JSON.parse(document.getElementById('productsData').value);
        
        fetch('/api/products', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                products: productsData
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Продукты успешно обновлены');
            } else {
                alert('Ошибка: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Ошибка:', error);
            alert('Произошла ошибка при обновлении продуктов');
        });
    } catch (e) {
        alert('Ошибка в формате данных: ' + e.message);
    }
});

// Сохранение хоз. товаров
document.getElementById('saveHoz').addEventListener('click', function() {
    try {
        var hozData = JSON.parse(document.getElementById('hozData').value);
        
        fetch('/api/hoz', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                hoz_items: hozData
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Хоз. товары успешно обновлены');
            } else {
                alert('Ошибка: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Ошибка:', error);
            alert('Произошла ошибка при обновлении хоз. товаров');
        });
    } catch (e) {
        alert('Ошибка в формате данных: ' + e.message);
    }
});

// Сохранение рыбы
document.getElementById('saveFish').addEventListener('click', function() {
    try {
        var fishData = JSON.parse(document.getElementById('fishData').value);
        
        fetch('/api/fish', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                fish_items: fishData
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Рыба успешно обновлена');
            } else {
                alert('Ошибка: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Ошибка:', error);
            alert('Произошла ошибка при обновлении рыбы');
        });
    } catch (e) {
        alert('Ошибка в формате данных: ' + e.message);
    }
});

// Сохранение курицы
document.getElementById('saveChicken').addEventListener('click', function() {
    try {
        var chickenData = JSON.parse(document.getElementById('chickenData').value);
        
        fetch('/api/chicken', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                chicken_items: chickenData
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Курица успешно обновлена');
            } else {
                alert('Ошибка: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Ошибка:', error);
            alert('Произошла ошибка при обновлении курицы');
        });
    } catch (e) {
        alert('Ошибка в формате данных: ' + e.message);
    }
});

// Сохранение паролей
document.getElementById('savePasswords').addEventListener('click', function() {
    var userPassword = document.getElementById('userPassword').value;
    var adminPassword = document.getElementById('adminPassword').value;
    
    // Сохраняем пароль пользователя
    fetch('/api/password', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            type: 'user',
            password: userPassword
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Сохраняем пароль администратора
            return fetch('/api/password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    type: 'admin',
                    password: adminPassword
                })
            });
        } else {
            throw new Error(data.message);
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Пароли успешно обновлены');
        } else {
            alert('Ошибка: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Ошибка:', error);
        alert('Произошла ошибка при обновлении паролей');
    });
});
{% endblock %}
